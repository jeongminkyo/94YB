<style>
  .button {
    background: white;
    border: 1px solid lightgray;
    margin-top: 10px;
  }
</style>

<div class="container">
  <% flash.each do |type, message| %>
    <div class="alert <%= bootstrap_class_for(type) %> alert-dismissable fade in">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      <p class="notice"><%= message %></p>
    </div>
  <% end %>
  <br>
  <div id="calendars"></div>
  <button class="btn btn-sm button">추가</button>
</div>

<script>
    initialize_calendar = function() {
        $('#calendars').each(function(){
            var calendar = $(this);
            calendar.fullCalendar({
                themeSystem: 'bootstrap3',
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay,listMonth'
                },
                eventLimit: true, // allow "more" link when too many calendars
                selectable: true,
                selectHelper: true,
                editable: true,
                eventLimit: true,
                events: '/calendars.json',
                timeFormat: '(HH:mm)',

                eventDrop: function(event, delta, revertFunc) {
                    event_data = {
                        calendar: {
                            id: event.id,
                            start: event.start.format(),
                            end: event.end.format()
                        }
                    };
                    $.ajax({
                        url: event.update_url,
                        data: event_data,
                        type: 'PATCH'
                    });
                },

                eventClick: function(event, jsEvent, view) {
                    $.getScript(event.edit_url, function() {
                        $('#event_date_range').val(moment(event.start).format("MM/DD/YYYY HH:mm") + ' - ' + moment(event.end).format("MM/DD/YYYY HH:mm"))
                        date_range_picker();
                        $('.start_hidden').val(moment(event.start).format('YYYY-MM-DD HH:mm'));
                        $('.end_hidden').val(moment(event.end).format('YYYY-MM-DD HH:mm'));
                    });
                }
            });
            $('.fc-sat').css('color','blue');
            $('.fc-sun').css('color','red');
        })
    }

    $('button').click(function(event) {
        $.getScript('<%= new_calendar_path %>', function() {
            $('#event_date_range').val(moment(event.start).format("MM/DD/YYYY HH:mm") + ' - ' + moment(event.end).format("MM/DD/YYYY HH:mm"))
            date_range_picker();
            $('.start_hidden').val(moment(event.start).format('YYYY-MM-DD HH:mm'));
            $('.end_hidden').val(moment(event.end).format('YYYY-MM-DD HH:mm'));
        });
    });

    $(document).on('turbolinks:load', initialize_calendar);
</script>